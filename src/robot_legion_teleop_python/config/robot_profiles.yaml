# SPDX-License-Identifier: LicenseRef-Proprietary
#
# robot_profiles.yaml
# ------------------
# This is the ONLY file you must edit when deploying to a new robot drive type.
#
# ✅ How the system decides "diff-drive vs mecanum":
#   - Each robot reads THIS file locally (on that robot) and uses `drive_profile`
#     to select a profile from the `profiles:` section.
#   - The robot's heartbeat_node publishes its selected profile + drive_type on
#     /<robot_name>/heartbeat so the teleop can learn it automatically.
#
# ✅ EASIEST DEPLOYMENT WORKFLOW (recommended):
#   1) Clone workspace on the robot
#   2) Open THIS file and set `drive_profile:` to the robot's drive type
#   3) Build + run motor_driver_node + heartbeat_node (and unit_executor if used)
#
# Available profiles (choose ONE):
#   - diff_hbridge     (2-motor differential drive via classic 2-channel H-bridge)
#   - mecanum_tb6612   (4-motor mecanum/omni via two TB6612FNG boards)
#
# NOTE:
# - Teleop laptop can leave this at the default (diff_hbridge) because teleop
#   will prefer the robot's heartbeat "self-identification" when available.

# --------------------------------------------
# ⭐ SELECTED DRIVE PROFILE (per-robot setting)
# --------------------------------------------
# Change this value ON EACH ROBOT to match its physical drive type.
drive_profile: diff_hbridge

# --------------------------------------------
# Defaults used only if drive_profile is absent
# --------------------------------------------
defaults:
  profile: diff_hbridge

profiles:
  # -------------------------------
  # Differential drive (2-channel H-bridge like your current setup)
  # -------------------------------
  diff_hbridge:
    drive_type: diff_drive
    hardware: hbridge_2ch
    cmd_vel_topic_template: "/{robot}/cmd_vel"
    params:
      wheel_separation: 0.18
      max_linear_speed: 0.40
      max_angular_speed: 2.00
      max_pwm: 100
    gpio:
      # BCM numbering (matches your current motor_driver_node defaults)
      en_a: 12
      in1: 17
      in2: 27
      in3: 22
      in4: 23
      en_b: 13

  # -------------------------------
  # Omnidirectional (mecanum) using TWO TB6612FNG boards (4 motors total)
  # -------------------------------
  mecanum_tb6612:
    drive_type: mecanum
    hardware: tb6612_4ch
    cmd_vel_topic_template: "/{robot}/cmd_vel"
    params:
      # These are "command-space" limits used to clamp Twist.
      # For a 2S pack (8.4V max), you may want max_pwm < 100 to protect TT motors.
      max_linear_speed: 0.50
      max_lateral_speed: 0.50
      max_angular_speed: 2.00
      max_pwm: 80

      # Mixing constant for omega contribution in mecanum mix:
      # wheel_i = vx +/- vy +/- (k_omega * omega)
      # Start with 0.22 and tune later if rotation is too aggressive or too weak.
      k_omega: 0.22

    gpio:
      # Optional standby/enable pin. If you hard-wire STBY->VCC on both boards,
      # set stby_pin to -1. If you wire STBY to a Pi GPIO, set it here.
      stby_pin: -1

      # Front-Left wheel
      fl_pwm: 12
      fl_in1: 5
      fl_in2: 6

      # Front-Right wheel
      fr_pwm: 13
      fr_in1: 16
      fr_in2: 19

      # Rear-Left wheel
      rl_pwm: 18
      rl_in1: 20
      rl_in2: 21

      # Rear-Right wheel
      rr_pwm: 26
      rr_in1: 23
      rr_in2: 24

# Optional mapping: map discovered robot names -> profile.
# If you want "central mapping" on the teleop laptop you can use this,
# but it is NOT required when using heartbeat self-identification.
robots: {}  # optional central mapping (leave empty when using heartbeat)
