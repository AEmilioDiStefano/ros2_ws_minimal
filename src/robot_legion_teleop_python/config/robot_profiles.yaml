# SPDX-License-Identifier: LicenseRef-Proprietary
#
# robot_profiles.yaml
#
# This file is intended to be copied onto each robot.
# The key scalability trick is:
#
#   drive_profile: <profile_name>
#
# Each robot sets its own drive_profile locally, so you don't need a central
# mapping table for every robot in the fleet.
#
# Teleop learns drive_type from heartbeat (preferred) or from this YAML (fallback).
# Motor driver + unit executor always use this YAML locally.

# -------------------------------------------------------------------
# ⭐ PER-ROBOT LOCAL SELECTION (recommended)
# -------------------------------------------------------------------
# On each robot, set THIS ONE LINE to match that robot's hardware.
# Examples:
#   drive_profile: diff_hbridge
#   drive_profile: mecanum_tb6612_4ch
drive_profile: diff_hbridge

# -------------------------------------------------------------------
# Optional: global defaults (used only if drive_profile is not set)
# -------------------------------------------------------------------
defaults:
  profile: diff_hbridge

# -------------------------------------------------------------------
# Optional: centralized mapping (usually unnecessary if drive_profile is used)
# -------------------------------------------------------------------
robots: {}
# robots:
#   robot1: diff_hbridge
#   robot2: mecanum_tb6612_4ch

# -------------------------------------------------------------------
# Profiles
# -------------------------------------------------------------------
profiles:

  # ================================================================
  # Differential drive using a generic 2-channel H-bridge
  # ================================================================
  diff_hbridge:
    drive_type: diff_drive
    hardware: hbridge_2ch

    cmd_vel_topic_template: "/{robot}/cmd_vel"

    params:
      # These values are used by motor_driver_node to scale Twist into motor outputs.
      max_linear_mps: 0.60
      max_angular_rps: 3.00

      # For diff kinematics: wheel separation in meters.
      # Used for converting Twist into left/right wheel speeds.
      wheel_separation_m: 0.18

      # Motor command smoothing:
      # 0.0 = no smoothing, 1.0 = very slow response.
      # Helps reduce jerk in cheap drivetrains.
      smoothing_alpha: 0.20

      # Safety watchdog: if cmd_vel stops arriving, stop after this many seconds.
      cmd_timeout_s: 0.50

      pwm_hz: 1000
      min_pwm_duty: 15.0   # optional; try 0 first, then 10–25 if needed
      cmd_timeout_s: 0.75  # optional; slightly more forgiving


    gpio:
      # Example GPIO map for a single H-bridge controlling left and right.
      # You MUST match these to your wiring.
      #
      # Each side uses:
      #   pwm: PWM pin
      #   in1/in2: direction pins
      #
      left:
        pwm: 18
        in1: 23
        in2: 24
      right:
        pwm: 19
        in1: 27
        in2: 22

  # ================================================================
  # Mecanum using 4 independent channels (e.g., TB6612 style)
  # ================================================================
  mecanum_tb6612_4ch:
    drive_type: mecanum
    hardware: tb6612_4ch

    cmd_vel_topic_template: "/{robot}/cmd_vel"

    params:
      # Mecanum max velocities
      max_linear_mps: 0.60
      max_strafe_mps: 0.50
      max_angular_rps: 3.00

      # Geometry used for mecanum mixing:
      #   wheelbase_m: front-back distance between wheel centers
      #   trackwidth_m: left-right distance between wheel centers
      wheelbase_m: 0.20
      trackwidth_m: 0.20

      smoothing_alpha: 0.20
      cmd_timeout_s: 0.50

    gpio:
      # Each wheel has pwm + two direction pins.
      # Name convention:
      #   fl = front-left, fr = front-right, rl = rear-left, rr = rear-right
      fl:
        pwm: 12
        in1: 5
        in2: 6
      fr:
        pwm: 13
        in1: 16
        in2: 26
      rl:
        pwm: 18
        in1: 20
        in2: 21
      rr:
        pwm: 19
        in1: 23
        in2: 24
